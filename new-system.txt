#!/usr/bin/env bash
# vim: ft=sh
#
# install according 
# pacstrap /mnt base vim

set -euo pipefail

grep '^en_US.UTF-8 UTF-8' /etc/locale.gen || {
  echo 'en_US.UTF-8 UTF-8' >> /etc/locale.gen
  locale-gen
}

localectl status | grep 'System Locale: LANG=en_US.UTF-8' || {
  localectl set-locale LANG=en_US.utf8
}

localectl status | grep 'VC Keymap: de' || {
  localectl set-keymap de
}

timedatectl set-ntp true

cat>/etc/profile.d/sane-defauls.sh <<EOF
alias ls='ls --color=auto --group-directories-first'
alias ll='ls -al'
alias less='less -S'
alias v='vim'
alias vim='vim'
alias ..='cd ..'

export EDITOR=nvim
EOF

# disable anoying speeper beep as termbell
echo "blacklist pcspkr" > /etc/modprobe.d/nobeep.conf

pacman -Sy
pacman -S --needed reflector
reflector --verbose -c Germany -p https --age 12 --sort score -f 5 --save /etc/pacman.d/mirrorlist

gnomePkgs=(adwaita-icon-theme eog evince gdm gnome-backgrounds gnome-calculator gnome-control-center gnome-dictionary gnome-disk-utility gnome-font-viewer gnome-keyring gnome-screenshot gnome-session gnome-settings-daemon gnome-shell gnome-shell-extensions gnome-system-monitor gnome-terminal gnome-themes-standard gucharmap gvfs gvfs-mtp gvfs-smb mousetweaks mutter nautilus networkmanager tracker tracker-miners xdg-user-dirs-gtk)

pacman -S --needed sudo ${gnomePkgs[@]} gnome-tweak-tool openssh xf86-video-intel zsh

for unit in gdm NetworkManager; do
  systemctl enable "$unit"
done

echo '%wheel ALL=(ALL) ALL' > /etc/sudoers.d/allow-wheel
chmod 0440 /etc/sudoers.d/allow-wheel
visudo -c -s

getent passwd flo || {
  useradd -m -G users,wheel -s /usr/bin/zsh flo
  passwd flo
}

